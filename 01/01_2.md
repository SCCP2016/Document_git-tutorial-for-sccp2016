Chapter 1.2 - Fundamentals - Git ~ Distributed VCS
=======

Gitを用いてバージョン管理されるファイルは、3つの状態を持ちます。

* 修正済<br>　... working directory内で変更され、まだlocal repositoryにcommitされていない状態
* ステージ済<br>　... 次のcommitでlocal repositoryに記録するためにチェックされている状態で、ステージ済のファイルはステージングエリアに追加されている
* コミット済<br>　... local repositoryにcommitされ、データが安全に格納されている状態

修正済、コミット済の状態は前頁を読めば理解するのは難しくはないと思います。「ステージ」というのはGit特有の概念で、修正済の状態のファイルをステージングエリア **(staging area)** に追加する操作のことを言い、 `git add` コマンドを使って対象のファイル名を指定することによってファイルのステージをすることができます。staging areaに追加された変更が次のcommitでlocal repositoryに記録されることになります。

working directory内のファイルを変更してからlocal repositoryにcommitするまでの流れをまとめると、

1. ファイルに変更を加える<br>`$ emacs test2.txt test3.txt`
2. ファイルをstaging areaに追加する<br>`$ git add test2.txt test3.txt`
3. commitする<br>`$ git commit -m  "commit message"` or `$ git commit`

> Gitで変更をcommitするときにはコミットメッセージの入力を要求されます。上記のように `-m` オプションでコミットメッセージを入力するか、 `$ git commit` とだけ入力した際に立ち上がるエディタを使ってコミットメッセージを編集するようにしてください。

![three states](./img/staging.png)

赤いファイルはまだ変更がlocal repositoryに記録されていないファイルを表しています。

前頁では編集したファイルの変更をそのままrepositoryにcommitするような図が示されていたと思いますが、実際には **「どのファイルの変更をcommitするかを選択する」** という操作が挟まっていたわけです。working directoryでファイルを変更しても、そのファイルをstaging areaに追加しなければlocal repositoryに変更が記録されることはありません。上の図では変更を加えたファイルを2つともstaging areaにaddしていますが、片方のファイルだけを選択してstaging areaに追加した場合はそのファイルの変更情報のみがlocal repositoryに記録されることになります。

### Storing method

大半のVCSは **「変更前のファイルからの変更差分(変更部分)」** をコンテンツとしてrepositoryに対してcommitをし、バージョン管理をファイル単位で行っています。しかしGitは若干バージョン管理の考え方が異なり、repositoryには **「commit時のworking directoryそのもののスナップショット(コピー・複製)」** がcommitのコンテンツとして保存され、ディレクトリ単位でバージョン管理が行われています。

![storing_vcs](./img/storing_vcs.png)

上の図は一般的なVCSの例です。最初にrepositoryにファイルを登録したVersion 1を起点として、commitの度に差分にバージョンが付けられていきます。差分というのは「前のバージョンからどれだけ変更があったか」の情報で、この例ではcommit時に前のバージョンからの差分が存在しないファイルについてはrepositoryに対してそのファイルに関する新しいバージョンの情報は記録されないことになります。

![storing_git](./img/storing_git.png)

一方Gitでは、他のVCSのようなファイルの変更差分ではなく変更されたファイルを含むworking directoryそのもののスナップショットがlocal repositoryに保存されます。ファイルに変更をした/しないに関わらずrepositoryにはworking directory内のファイルが全てツリー構造ごとそのままcommitのコンテンツとして保存されることになります。

Gitを使っていく上ではユーザーが意識する必要はありませんが、Gitが持つ特徴の一つとして頭の片隅に入れておきましょう。

### Life Cycle of Git

local repositoryにcommitされた内容はremote repositoryにpushすることによってその内容を同期させることができます。

```
例)
$ git push origin master
```

`git push` コマンドは第一引数にremote repositoryの名前、第二引数としてブランチ名([Managing branches](../04/04_0.md)のchapterで後述)などを取ります。